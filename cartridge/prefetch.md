# カートリッジのプリフェッチ

カートリッジのプリフェッチは`WAITCNT.14`で有効にすることができます。

プリフェッチが有効になっている場合、GBAはCPUがバスを使用していない間、カートリッジROMからオペコードを読み出そうとします。

CPUが既にバッファにプリフェッチされているデータを要求した場合、メモリアクセスの際のウェイトステートは`0`になり1サイクルでアクセスできます。

プリフェッチバッファには、最大8つの16bit値が格納できます。

> [!NOTE]
> プリフェッチはカートリッジのオペコードに対してのみ有効です。RAMやBIOSに配置されたオペコードに対してはプリフェッチは行われません。

## 有効な場面

プリフェッチは次のようなオペコードで発生します。

```
  1. 実行時にIサイクルが発生し、かつ R15を変更しない 命令
      shift/rotate register-by-register
      load opcodes (ldr,ldm,pop,swp)
      multiply opcodes
  2. カートリッジ以外への ロードストア命令
      ldr,str,ldm,stm,etc.
```

## プリフェッチ無効バグ

プリフェッチが無効になっている場合、プリフェッチ無効バグが発生します。

"カートリッジROM内の命令の内、内部サイクル(Iサイクル)が発生し、R15を変更しない命令"(上記の"1"の命令たち) のコードフェッチ時間が 1S から 1N になってしまいます。

