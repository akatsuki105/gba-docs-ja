# タイマー

GBAは16bitのタイマーを4つ持っています。

タイマー0とタイマー1はDMAサウンドチャネルA/Bのサンプルレートのために使われます。

```
4000100h - TM0CNT_L - タイマーカウンタ/リロード0 (R/W)
4000104h - TM1CNT_L - タイマーカウンタ/リロード1 (R/W)
4000108h - TM2CNT_L - タイマーカウンタ/リロード2 (R/W)
400010Ch - TM3CNT_L - タイマーカウンタ/リロード3 (R/W)
```

これらのレジスタへの書き込み処理はリロード値を初期化します(ただし現在のカウンタの値には直接影響しません)。

読み込み処理は、現在のカウンタの値を読み取ります(タイマーがストップしているときは直近の値が読み取られる)。

リロード値は次の２つの場合にのみカウンタにコピーされます。

タイマーオーバーフロー時に自動的にコピーされる場合と、タイマースタートビットが0から1に変更された場合です。

注：スタートビットを0から1に変更すると同時にリロード値を設定した場合（1回の32ビットI/O操作で）、新たに書き込まれたリロード値は新しいカウンタ値として認識されます。

```
4000102h - TM0CNT_H - タイマー制御0 (R/W)
4000106h - TM1CNT_H - タイマー制御1 (R/W)
400010Ah - TM2CNT_H - タイマー制御2 (R/W)
400010Eh - TM3CNT_H - タイマー制御3 (R/W)
```

```
  Bit   内容
  0-1   Prescaler Selection (0=F/1, 1=F/64, 2=F/256, 3=F/1024)      ; F=システムクロック(16.78MHz)
  2     Count-up Timing   (0=通常, 1=後述)                   ; TM0CNT_H は除く
  3-5   未使用
  6     タイマー割り込み有効無効  (0=無効, 1=タイマーオーバーフロー時にIRQ)
  7     タイマー有効無効  (0=無効, 1=有効)
  8-15  未使用
```

カウントアップ機能(bit2)を有効にすると、プリスケーラの値(bit0-1)は無視され、前のカウンタがオーバーフローするたびに時間がインクリメントされます。この機能はタイマー0には使用できません（タイマー0は最初のタイマーなので）。
